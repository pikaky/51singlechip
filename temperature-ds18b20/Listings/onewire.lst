C51 COMPILER V9.54   ONEWIRE                                                               09/15/2021 16:19:42 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE ONEWIRE
OBJECT MODULE PLACED IN .\Objects\onewire.obj
COMPILER INVOKED BY: D:\Èí¼ş\ku5\C51\BIN\C51.EXE onewire.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\
                    -onewire.lst) TABS(2) OBJECT(.\Objects\onewire.obj)

line level    source

   1          #include <REGX51.H>
   2          
   3          sbit onewire_DQ=P3^7;
   4          
   5          
   6          unsigned char  onewire_init(void)
   7          {
   8   1        unsigned char ackbit;
   9   1        unsigned char i;
  10   1        onewire_DQ=1;  //çœ‹å›¾ å…ˆæ‹‰ä½
  11   1        onewire_DQ=0;
  12   1        
  13   1        i = 247;while (--i);   //å»¶æ—¶500usï¼›
  14   1        
  15   1        onewire_DQ=1;
  16   1        
  17   1        i = 32;while (--i); //å»¶æ—¶70usï¼›
  18   1        ackbit=onewire_DQ;
  19   1        
  20   1        i = 247;while (--i);  //å†å»¶æ—¶500usï¼›ç»“æŸåˆå§‹åŒ–
  21   1        return ackbit;
  22   1        
  23   1      }
  24          
  25          void onewire_sentbit(unsigned char BIT)
  26          {
  27   1        unsigned char i; 
  28   1        onewire_DQ=0;  
  29   1        i = 4;while (--i);   //å»¶æ—¶10us
  30   1        onewire_DQ=BIT;      //å‘é€bit=1æ—¶ï¼Œåœ¨10usæ—¶ï¼Œdqå˜æˆ1ï¼Œ30usæ—¶åˆ¤æ–­é«˜ï¼Œè¡¨ç¤ºå‘é€äº†1
  31   1                             //å‘é€bit=0æ—¶ï¼Œåœ¨10usæ—¶ï¼Œdqè¿˜æ˜¯0ï¼Œ30usæ—¶åˆ¤æ–­ä½ï¼Œè¡¨ç¤ºå‘é€äº†0
  32   1        i = 24;while (--i);  //å»¶æ—¶50us
  33   1        onewire_DQ=1;   //é‡Šæ”¾æ€»çº¿
  34   1      }
  35          unsigned char onewire_receivebit(void)
  36          {
  37   1        unsigned char i; 
  38   1        unsigned char BIT;  //çœ‹å›¾ å…ˆæ‹‰ä½
  39   1        onewire_DQ=0;
  40   1        
  41   1        i = 2;while (--i);  //å»¶æ—¶8us
  42   1        onewire_DQ=1; //é‡Šæ”¾æ€»çº¿
  43   1        i = 2;while (--i);  //å»¶æ—¶8us ç»™æœºå™¨ååº”æ—¶é—´
  44   1        BIT=onewire_DQ; //æ¥å—æ•°æ®
  45   1        i = 24;while (--i); //å»¶æ—¶48us
  46   1        
  47   1        return BIT;
  48   1      }
  49          void onewire_sendbyte(unsigned char byte)
  50          {
  51   1        unsigned char i;
  52   1        for(i=0;i<8;i++)
  53   1        {
  54   2          onewire_sentbit(byte&(0x01<<i)); //ä½ä½åœ¨å‰ ä»åå¾€å‰è¯»æ•°
C51 COMPILER V9.54   ONEWIRE                                                               09/15/2021 16:19:42 PAGE 2   

  55   2        }
  56   1      }
  57          
  58          unsigned char onewire_receivebyte(void)
  59          {
  60   1        unsigned char i;
  61   1        unsigned char byte=0x00;
  62   1        for(i=0;i<8;i++)
  63   1        {
  64   2          if(onewire_receivebit()){byte|=(0x01<<i);} //byteåŸæ¥æ˜¯0x00ï¼Œæ¯é‡åˆ°ä¸€æ¬¡1ï¼Œ|0x01<<i å˜æˆ1ï¼Œ0
             -è¿˜æ˜¯0.ä¸€ä½ä¸€ä½ç½®1
  65   2        
  66   2        }
  67   1        
  68   1        return byte;
  69   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    122    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
